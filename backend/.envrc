#!/usr/bin/env bash
set -euo pipefail
__prevEnv__="$(env)"

DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"
export NX_WORKSPACE_ROOT=${DIR}

PATH_add node_modules/.bin
PATH_add tools/bin
PATH_add packages/dev/database/bin

export HASURA_VERSION="2.35.1"
export NATS_VERSION="0.1.1"

export FIXTURE_DIR="${NX_WORKSPACE_ROOT}/tests/fixtures"

export WORKSPACE_NAME="kedge"
export DEV_NETWORK_NAME="kedge_network"
export HASURA_GRAPHQL_SERVER_PORT="28717"
export HASURA_GRAPHQL_ADMIN_SECRET="9AgJckEMHPRgrasj7Ey8jR"

export NODE_DATABASE_URL="postgres://postgres:postgres@127.0.0.1:7543/kedge_db"

export JWT_SECRET="111"
export REDIS_DB=0
export REDIS_HOST=localhost
export REDIS_PORT=6379

export API_PORT=8718
export ENABLE_DEBUG_INFO=true
export LOG_LEVEL=debug
export NODE_ENV=development
export QUIZ_STORAGE_PATH="./quiz-storage"

# OpenAI API key for GPT-based modules
export OPENAI_API_KEY=""

if [[ -f .envrc.override ]]; then
  source_env .envrc.override
fi

# export updated ENV of this file
node "${NX_WORKSPACE_ROOT}/tools/bin/get-env" "${__prevEnv__}" "$(env)" >"${NX_WORKSPACE_ROOT}/.env" &
